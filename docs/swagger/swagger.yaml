basePath: /api/v1
definitions:
  main.DailyStats:
    properties:
      hourly_breakdown:
        items:
          additionalProperties: true
          type: object
        type: array
      summary:
        additionalProperties: true
        type: object
      timestamp:
        type: string
    type: object
  main.DashboardSummary:
    properties:
      current_status:
        additionalProperties: true
        description: Real-time status (epoch, queues)
        type: object
      participation_stats:
        additionalProperties: true
        description: 24h participation/inclusion metrics
        type: object
      recent_activity:
        additionalProperties: true
        description: 1m and 5m activity
        type: object
      system_metrics:
        additionalProperties: true
        description: Rates, totals, current counts (includes VPA metrics)
        type: object
      timestamp:
        type: string
      validator_id:
        type: string
      vpa_metrics:
        additionalProperties: true
        description: VPA-specific metrics (priority assignments, submissions)
        type: object
    type: object
  main.EnhancedTimelineEvent:
    properties:
      entity_id:
        type: string
      metadata:
        $ref: '#/definitions/main.TimelineEventMetadata'
      time:
        type: string
      timestamp:
        type: integer
    type: object
  main.EnhancedTimelineResponse:
    properties:
      count:
        type: integer
      events:
        items:
          $ref: '#/definitions/main.EnhancedTimelineEvent'
        type: array
      minutes:
        type: integer
      timestamp:
        type: string
      type:
        type: string
    type: object
  main.EpochInfo:
    properties:
      data_market:
        type: string
      duration:
        type: integer
      epoch_id:
        type: string
      level1_batch_exists:
        type: boolean
      level2_batch_exists:
        type: boolean
      phase:
        description: '"submission", "finalization", "aggregation", "complete"'
        type: string
      start_time:
        type: integer
      status:
        description: '"open", "closed"'
        type: string
    type: object
  main.FinalizedBatch:
    properties:
      epoch_id:
        type: string
      has_gap:
        description: Whether epoch has a gap
        type: boolean
      ipfs_cid:
        type: string
      level:
        description: 1 for local, 2 for aggregated
        type: integer
      merkle_root:
        type: string
      onchain_status:
        description: On-chain submission status
        type: string
      phase:
        description: Current phase of epoch
        type: string
      project_count:
        type: integer
      timestamp:
        type: integer
      type:
        description: '"local" or "aggregated"'
        type: string
      validator_count:
        description: Level 2 only
        type: integer
      validator_id:
        description: Level 1 only
        type: string
      validator_ids:
        description: Level 2 only
        items:
          type: string
        type: array
    type: object
  main.HourlyStats:
    properties:
      hours:
        items:
          additionalProperties: true
          type: object
        type: array
      timestamp:
        type: string
    type: object
  main.QueueStatus:
    properties:
      depth:
        type: integer
      queue_name:
        type: string
      status:
        description: '"empty", "healthy", "moderate", "high", "critical"'
        type: string
    type: object
  main.TimelineEventMetadata:
    properties:
      data_market:
        type: string
      epoch_id:
        type: string
      event_type:
        description: '"submission", "validation", "batch", "epoch"'
        type: string
      is_enhanced:
        description: Whether entity ID uses new enhanced format
        type: boolean
      peer_id:
        type: string
      project_id:
        type: string
      slot_id:
        type: string
      submission_type:
        description: '"snapshot", "validation"'
        type: string
      validator_id:
        type: string
    type: object
  main.VPAEpochStatusResponse:
    properties:
      epoch_id:
        type: string
      status:
        additionalProperties: true
        description: Combined priority and submission status
        type: object
      timestamp:
        type: string
    type: object
  main.VPAStatsResponse:
    properties:
      stats:
        additionalProperties: true
        description: Contains priority assignments, submissions, success rates, etc.
        type: object
      timestamp:
        type: string
    type: object
  main.VPATimelineResponse:
    properties:
      timeline:
        additionalProperties: true
        description: Contains "priority_timeline" and/or "submission_timeline"
        type: object
      timestamp:
        type: string
    type: object
info:
  contact: {}
  description: Monitoring API that reads pre-aggregated data from state-tracker worker
  title: DSV Pipeline Monitor API (Direct Redis)
  version: "3.0"
paths:
  /aggregation/results:
    get:
      description: Get network-wide aggregated batches with validator contributions
      parameters:
      - description: Protocol state identifier
        in: query
        name: protocol
        type: string
      - description: Data market address
        in: query
        name: market
        type: string
      - description: Number of results (default 20)
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/main.FinalizedBatch'
            type: array
      summary: Aggregation results
      tags:
      - aggregation
  /batches/finalized:
    get:
      description: Get Level 1 (local) or Level 2 (aggregated) finalized batches
      parameters:
      - description: Protocol state identifier
        in: query
        name: protocol
        type: string
      - description: Data market address
        in: query
        name: market
        type: string
      - description: Batch level (1 or 2, default both)
        in: query
        name: level
        type: integer
      - description: Specific epoch ID
        in: query
        name: epoch_id
        type: string
      - description: Number of batches to retrieve (default 50)
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/main.FinalizedBatch'
            type: array
      summary: Finalized batches
      tags:
      - batches
  /dashboard/summary:
    get:
      description: Get pre-aggregated dashboard metrics from state-tracker
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/main.DashboardSummary'
      summary: Dashboard summary
      tags:
      - dashboard
  /epochs/{epochId}/status:
    get:
      description: Get complete epoch state with all phase information
      parameters:
      - description: Epoch ID
        in: path
        name: epochId
        required: true
        type: string
      - description: Protocol state identifier
        in: query
        name: protocol
        type: string
      - description: Data market address
        in: query
        name: market
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
      summary: Epoch status
      tags:
      - epochs
  /epochs/active:
    get:
      description: Get epochs currently in progress (window open, level 1/2 in progress)
      parameters:
      - description: Protocol state identifier
        in: query
        name: protocol
        type: string
      - description: Data market address
        in: query
        name: market
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/main.EpochInfo'
            type: array
      summary: Active epochs
      tags:
      - epochs
  /epochs/gaps:
    get:
      description: Identify epochs that should have finalizations but don't
      parameters:
      - description: Protocol state identifier
        in: query
        name: protocol
        type: string
      - description: Data market address
        in: query
        name: market
        type: string
      - description: Window minutes to check for gaps (default 5)
        in: query
        name: window_minutes
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
      summary: Epoch gaps
      tags:
      - epochs
  /epochs/timeline:
    get:
      description: Get epoch progression with phases and batch status
      parameters:
      - description: Protocol state identifier
        in: query
        name: protocol
        type: string
      - description: Data market address
        in: query
        name: market
        type: string
      - description: Number of epochs (default 50)
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/main.EpochInfo'
            type: array
      summary: Epochs timeline
      tags:
      - epochs
  /health:
    get:
      description: Check if the API and Redis connection are healthy
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
      summary: Health check
      tags:
      - health
  /pipeline/overview:
    get:
      description: Get pipeline metrics from pre-aggregated data
      parameters:
      - description: Protocol state identifier
        in: query
        name: protocol
        type: string
      - description: Data market address
        in: query
        name: market
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
      summary: Pipeline overview (legacy support)
      tags:
      - pipeline
  /queues/status:
    get:
      description: Get real-time queue depths and processing rates
      parameters:
      - description: Protocol state identifier
        in: query
        name: protocol
        type: string
      - description: Data market address
        in: query
        name: market
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/main.QueueStatus'
            type: array
      summary: Queue status
      tags:
      - queues
  /stats/daily:
    get:
      description: Get pre-aggregated 24-hour statistics
      parameters:
      - description: Protocol state identifier
        in: query
        name: protocol
        type: string
      - description: Data market address
        in: query
        name: market
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/main.DailyStats'
      summary: Daily statistics
      tags:
      - stats
  /stats/hourly:
    get:
      description: Get pre-aggregated hourly statistics
      parameters:
      - description: Protocol state identifier
        in: query
        name: protocol
        type: string
      - description: Data market address
        in: query
        name: market
        type: string
      - description: Number of hours to retrieve (default 24)
        in: query
        name: hours
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/main.HourlyStats'
      summary: Hourly statistics
      tags:
      - stats
  /timeline/recent:
    get:
      description: Get recent events from timeline sorted sets with enriched metadata
      parameters:
      - description: Event type (submission, validation, epoch, batch)
        in: query
        name: type
        type: string
      - description: Minutes to look back (default 5)
        in: query
        name: minutes
        type: integer
      - description: Include detailed metadata from Redis (default true)
        in: query
        name: include_metadata
        type: boolean
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/main.EnhancedTimelineResponse'
      summary: Recent timeline
      tags:
      - timeline
  /vpa/epoch/{epochID}:
    get:
      description: Get priority assignment and submission status for a specific epoch.
        Returns combined priority and submission information including priority details
        and submission details if available.
      parameters:
      - description: Epoch ID
        in: path
        name: epochID
        required: true
        type: string
      - description: Protocol state identifier (defaults to configured protocol)
        in: query
        name: protocol
        type: string
      - description: Data market address (defaults to configured market)
        in: query
        name: market
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: VPA epoch status with priority and submission information
          schema:
            $ref: '#/definitions/main.VPAEpochStatusResponse'
        "404":
          description: Epoch not found
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties: true
            type: object
      summary: Get VPA status for specific epoch
      tags:
      - vpa
  /vpa/epoch/{epochID}/lifecycle:
    get:
      description: Track complete lifecycle of an epoch from release to submission,
        showing all stages and timing
      parameters:
      - description: Epoch ID to track
        in: path
        name: epochID
        required: true
        type: string
      - description: Protocol state identifier (defaults to configured protocol)
        in: query
        name: protocol
        type: string
      - description: Data market address (defaults to configured market)
        in: query
        name: market
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Epoch lifecycle with all stages and timing
          schema:
            additionalProperties: true
            type: object
      summary: Get epoch lifecycle tracking
      tags:
      - vpa
  /vpa/stats:
    get:
      description: Get aggregated VPA statistics including total priority assignments,
        submission counts (success/failed), success rates, and 24-hour activity counts.
      parameters:
      - description: Protocol state identifier (defaults to configured protocol)
        in: query
        name: protocol
        type: string
      - description: Data market address (defaults to configured market)
        in: query
        name: market
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Aggregated VPA statistics
          schema:
            $ref: '#/definitions/main.VPAStatsResponse'
      summary: Get VPA statistics
      tags:
      - vpa
  /vpa/timeline:
    get:
      description: Get priority assignment and submission timeline. Returns recent
        priority assignments and/or submissions ordered by timestamp (most recent
        first).
      parameters:
      - description: Protocol state identifier (defaults to configured protocol)
        in: query
        name: protocol
        type: string
      - description: Data market address (defaults to configured market)
        in: query
        name: market
        type: string
      - description: 'Timeline type: ''priority'', ''submission'', or ''both'' (default:
          ''both'')'
        in: query
        name: type
        type: string
      - description: 'Number of entries to retrieve per timeline type (default: 50,
          max: 1000)'
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: VPA timeline with priority and/or submission entries
          schema:
            $ref: '#/definitions/main.VPATimelineResponse'
      summary: Get VPA timeline
      tags:
      - vpa
swagger: "2.0"
